<!DOCTYPE html>
<html>
<head>
<title>Smart Civic Complaint Voice Agent</title>

<style>
body {
  font-family: Arial;
  background: linear-gradient(135deg,#00071d,#1cc88a);
  color: rgb(235, 231, 231);
  text-align: center;
  padding: 20px;
  transition: 0.3s;
}

.dark { background:#151515; }

#chat {
  background: white;
  color: rgb(28, 24, 24);
  height: 300px;
  overflow-y: auto;
  padding: 10px;
  border-radius: 10px;
  margin-bottom:10px;
}

button, select {
  padding: 10px 20px;
  margin: 5px;
  border: none;
  border-radius: 20px;
  cursor: pointer;
}

table {
  margin-top:10px;
  font-size:14px;
}

th {
  background:#02103b;
  color:rgb(235, 222, 222);
  padding:5px;
}

td {
  padding:5px;
  text-align:center;
}

.user { text-align:right; margin:5px; }
.bot { text-align:left; margin:5px; color:green; }

#dashboard {
  display:none;
  background:white;
  color:rgb(12, 12, 12);
  padding:15px;
  border-radius:10px;
  margin-top:15px;
}
</style>

</head>

<body>

<h2>ðŸŽ¤ Smart Civic Complaint Voice Agent</h2>

<select id="languageSelect" onchange="changeLanguage()">
  <option value="hi-IN">Hindi</option>
  <option value="en-US">English</option>
  <option value="mr-IN">Marathi</option>
</select>

<div id="chat"></div>

<input type="text" id="textInput" placeholder="Type here...">
<br>
<button onclick="sendText()">Send</button>
<button onclick="startListening()">ðŸŽ™ Speak</button>
<button onclick="toggleMode()">ðŸŒ™ Mode</button>
<button onclick="showDashboard()">ðŸ“Š Admin</button>

<!-- Dashboard Section -->
<div id="dashboard">
  <h3>ðŸ“Š Complaint Dashboard</h3>
  <p id="totalCount"></p>
  <table border="1" width="100%" style="border-collapse:collapse;">
    <thead>
      <tr>
        <th>ID</th>
        <th>Name</th>
        <th>Type</th>
        <th>Area</th>
        <th>Date</th>
        <th>Status</th>
      </tr>
    </thead>
    <tbody id="complaintTable"></tbody>
  </table>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

<script>

// ðŸ”¥ Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyBaGN807IVZxRE13XIL73ft-Lkxua-2l9k",
  authDomain: "civic-5af7b.firebaseapp.com",
  projectId: "civic-5af7b",
  storageBucket: "civic-5af7b.firebasestorage.app",
  messagingSenderId: "484548445203",
  appId: "1:484548445203:web:0565fa9a544069f7bfabe6",
  measurementId: "G-0WL4FZHHWY"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

let selectedLanguage = "hi-IN";
let userName = "";
let complaintType = "";
let complaintArea = "";
let step = 0;

const chat = document.getElementById("chat");

// ðŸŒ Multi Language Messages
const messages = {
  "hi-IN": {
    welcome: "Namaste! Aapka naam kya hai?",
    askComplaint: "Kaunsi complaint register karni hai?",
    askArea: "Kaunsa area?",
    thanks: "Dhanyavaad",
    registered: "Aapki complaint register ho gayi. Complaint ID: "
  },
  "en-US": {
    welcome: "Hello! What is your name?",
    askComplaint: "What complaint would you like to register?",
    askArea: "Which area?",
    thanks: "Thank you",
    registered: "Your complaint has been registered. Complaint ID: "
  },
  "mr-IN": {
    welcome: "à¤¨à¤®à¤¸à¥à¤•à¤¾à¤°! à¤¤à¥à¤®à¤šà¤‚ à¤¨à¤¾à¤µ à¤•à¤¾à¤¯ à¤†à¤¹à¥‡?",
    askComplaint: "à¤•à¥‹à¤£à¤¤à¥€ à¤¤à¤•à¥à¤°à¤¾à¤° à¤¨à¥‹à¤‚à¤¦à¤µà¤¾à¤¯à¤šà¥€ à¤†à¤¹à¥‡?",
    askArea: "à¤•à¥‹à¤£à¤¤à¤¾ à¤ªà¤°à¤¿à¤¸à¤°?",
    thanks: "à¤§à¤¨à¥à¤¯à¤µà¤¾à¤¦",
    registered: "à¤¤à¥à¤®à¤šà¥€ à¤¤à¤•à¥à¤°à¤¾à¤° à¤¨à¥‹à¤‚à¤¦à¤µà¤²à¥€ à¤—à¥‡à¤²à¥€ à¤†à¤¹à¥‡. à¤¤à¤•à¥à¤°à¤¾à¤° à¤•à¥à¤°à¤®à¤¾à¤‚à¤•: "
  }
};

// ðŸŒ Change Language
function changeLanguage(){
  selectedLanguage = document.getElementById("languageSelect").value;
  chat.innerHTML="";
  step=0;
  let welcome = messages[selectedLanguage].welcome;
  addMessage(welcome,"bot");
  speak(welcome);
}

// ðŸ’¬ Add Message
function addMessage(msg, sender){
  const div = document.createElement("div");
  div.className = sender;
  div.innerText = msg;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}

// ðŸ”Š Speak
function speak(text){
  const speech = new SpeechSynthesisUtterance(text);
  speech.lang = selectedLanguage;
  window.speechSynthesis.speak(speech);
}

// ðŸ†” Generate ID
function generateID(){
  return "CMP" + Math.floor(1000 + Math.random()*9000);
}

// ðŸ”¥ Save Complaint
function saveComplaint(data){
  db.collection("complaints").add(data);
}

// ðŸ¤– Process Input
function processInput(input){

  addMessage(input,"user");

  if(step === 0){
    userName = input;
    step = 1;
    let reply = userName + ", " + messages[selectedLanguage].askComplaint;
    addMessage(reply,"bot");
    speak(reply);
  }

  else if(step === 1){
    complaintType = input;
    step = 2;
    let reply = messages[selectedLanguage].askArea;
    addMessage(reply,"bot");
    speak(reply);
  }

  else if(step === 2){
    complaintArea = input;

    let id = generateID();
    let date = new Date().toLocaleString();

    let complaintData = {
      name: userName,
      type: complaintType,
      area: complaintArea,
      id: id,
      date: date,
      status: "Registered"
    };

    saveComplaint(complaintData);

    let reply = messages[selectedLanguage].thanks + " " + userName +
    ". " + messages[selectedLanguage].registered + id;

    addMessage(reply,"bot");
    speak(reply);

    step = 1;
  }
}

// ðŸ“© Send Text
function sendText(){
  let input = document.getElementById("textInput").value;
  document.getElementById("textInput").value="";
  if(input.trim() !== ""){
    processInput(input);
  }
}

// ðŸŽ™ Voice Recognition
function startListening(){
  const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
  recognition.lang = selectedLanguage;
  recognition.start();

  recognition.onresult = function(event){
    let voiceText = event.results[0][0].transcript;
    processInput(voiceText);
  };
}

// ðŸŒ™ Dark Mode
function toggleMode(){
  document.body.classList.toggle("dark");
}

// ðŸ“Š Show Dashboard with History
function showDashboard(){

  const dashboard = document.getElementById("dashboard");
  const table = document.getElementById("complaintTable");
  const totalCount = document.getElementById("totalCount");

  dashboard.style.display = "block";
  table.innerHTML = "";

  db.collection("complaints").get()
  .then(snapshot => {

    totalCount.innerText = "Total Complaints: " + snapshot.size;

    snapshot.forEach(doc => {
      const data = doc.data();

      const row = `
        <tr>
          <td>${data.id}</td>
          <td>${data.name}</td>
          <td>${data.type}</td>
          <td>${data.area}</td>
          <td>${data.date}</td>
          <td>${data.status}</td>
        </tr>
      `;

      table.innerHTML += row;
    });

  });
}

// ðŸš€ On Load
window.onload = function(){
  let welcome = messages[selectedLanguage].welcome;
  addMessage(welcome,"bot");
  speak(welcome);
}

</script>
</body>
</html>
