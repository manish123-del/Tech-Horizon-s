<!DOCTYPE html>
<html>
<head>
<title>Smart Civic Complaint Voice Agent</title>

<style>
body {
  font-family: Arial;
  background: linear-gradient(135deg,#4e73df,#1cc88a);
  color: white;
  text-align: center;
  padding: 20px;
}

.dark { background:#111; }

#chat {
  background: white;
  color: black;
  height: 300px;
  overflow-y: auto;
  padding: 10px;
  border-radius: 10px;
}

button {
  padding: 10px 20px;
  margin: 5px;
  border: none;
  border-radius: 20px;
  cursor: pointer;
}

.user { text-align:right; margin:5px; }
.bot { text-align:left; margin:5px; color:green; }
</style>

</head>

<body>

<h2>ðŸŽ¤ Smart Civic Complaint Voice Agent</h2>

<div id="chat"></div>

<input type="text" id="textInput" placeholder="Type here...">
<button onclick="sendText()">Send</button>
<button onclick="startListening()">ðŸŽ™ Speak</button>
<button onclick="toggleMode()">ðŸŒ™ Mode</button>
<button onclick="showDashboard()">ðŸ“Š Admin</button>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

<script>

// ðŸ”¥ PASTE YOUR FIREBASE CONFIG HERE
const firebaseConfig = {
  apiKey: "AIzaSyBaGN807IVZxRE13XIL73ft-Lkxua-2l9k",
  authDomain: "civic-5af7b.firebaseapp.com",
  projectId: "civic-5af7b",
  storageBucket: "civic-5af7b.firebasestorage.app",
  messagingSenderId: "484548445203",
  appId: "1:484548445203:web:0565fa9a544069f7bfabe6",
  measurementId: "G-0WL4FZHHWY"
};
// Init Firebase
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

let userName = "";
let complaintType = "";
let complaintArea = "";
let step = 0;

const chat = document.getElementById("chat");

function addMessage(msg, sender){
  const div = document.createElement("div");
  div.className = sender;
  div.innerText = msg;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}

function speak(text){
  const speech = new SpeechSynthesisUtterance(text);
  speech.lang = "hi-IN";
  window.speechSynthesis.speak(speech);
}

function generateID(){
  return "CMP" + Math.floor(1000 + Math.random()*9000);
}

// ðŸ”¥ Save to Firebase
function saveComplaint(data){
  db.collection("complaints").add(data)
  .then(() => console.log("Saved"))
  .catch(err => console.log(err));
}

function processInput(input){

  addMessage(input,"user");

  if(step === 0){
    userName = input;
    step = 1;
    let reply = "Namaste " + userName + ", kaunsi complaint register karni hai?";
    addMessage(reply,"bot");
    speak(reply);
  }

  else if(step === 1){
    complaintType = input;
    step = 2;
    let reply = "Kaunsa area?";
    addMessage(reply,"bot");
    speak(reply);
  }

  else if(step === 2){
    complaintArea = input;

    let id = generateID();
    let date = new Date().toLocaleString();

    let complaintData = {
      name: userName,
      type: complaintType,
      area: complaintArea,
      id: id,
      date: date,
      status: "Registered"
    };

    saveComplaint(complaintData);

    let reply = "Dhanyavaad " + userName + 
    ". Aapki complaint register ho gayi.\nComplaint ID: " 
    + id;

    addMessage(reply,"bot");
    speak("Aapki complaint register ho gayi. Aapka complaint ID hai " + id);

    step = 1;
  }
}

function sendText(){
  let input = document.getElementById("textInput").value;
  document.getElementById("textInput").value="";
  if(input.trim() !== ""){
    processInput(input);
  }
}

function startListening(){
  const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
  recognition.lang = "hi-IN";
  recognition.start();

  recognition.onresult = function(event){
    let voiceText = event.results[0][0].transcript;
    processInput(voiceText);
  };
}

function toggleMode(){
  document.body.classList.toggle("dark");
}

// ðŸ”¥ Admin Dashboard (Real Cloud Count)
function showDashboard(){
  db.collection("complaints").get()
  .then(snapshot => {
    alert("Total Complaints: " + snapshot.size);
  });
}

window.onload = function(){
  let welcome = "Namaste! Aapka naam kya hai?";
  addMessage(welcome,"bot");
  speak(welcome);
}

</script>
</body>
</html>
